<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <link href="base.css" rel="stylesheet" type="text/css"/>
    <style>
        #a{width:800px;margin:0 auto;}
        .tableWrap{position:relative;border:1px solid #ddd;border-bottom:0;}
        .sec0{position:absolute;left:0;top:0;z-index:1;overflow:hidden;}
        .sec1{position:relative;left:0;top:0;overflow-x:scroll;overflow-y:hidden;}
        .tableLayout{background-color:#fff;}
        .tableLayout td,.tableLayout th{padding:6px 8px;line-height:1.5;white-space:nowrap;}
        .tableLayout td{text-align:center;border:1px solid #ddd;border-left:0;}
        .tableLayout th{border-bottom:3px solid #85664B;border-right:1px solid #B9936F;background-color:#A47A54;color:#fff;}
    </style>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript">
        $.fn.fixTable = function(opts){
            var defaults = {};
            opts = $.extend({},defaults,opts);
            var _this = $(this);
            var init_w = parseInt($(this).width());
            var ancestor = $(this).parents('.tableWrap');
            if(ancestor.length){
                if(!$('.sec0',ancestor).length){
                    fn();
                    return false;
                }
                var w = $(this).width();
                if(opts.w > w){
                    // 滚动条为空是,ie中滚动条右侧出现蓝色竖条
                    $(this).width(opts.w-1);
                }
                var fixW = $(this).find('tr:first th:first').outerWidth();
                $('.sec0',ancestor).width(fixW+1);
            }else{
                $(this).wrap('<div class="tableWrap" style="width:' + (opts.w-2) + 'px"></div>');
                fn();
            }

            function fn(){
                if(opts.w < init_w){
                    var col_fir = '';
                    $('tr',_this).each(function(){
                        var a = document.createElement('div');
                        a.appendChild($(':first-child',this).clone()[0]);
                        col_fir += '<tr>' + a.innerHTML + '</tr>';
                    })
                    var $cont = $('<table class="tableLayout" width="100%">' + col_fir +'</table>');
                    _this.before($cont);
                    _this.width('auto').wrap('<div class="sec1"></div>');
                    var fixW = _this.find('tr:first th:first').outerWidth();
                    $cont.wrap('<div class="sec0" style="width:' + (fixW + 1) + 'px"></div>');
                }else{
                    _this.width(opts.w-2);
                }
            }
        }
    </script>
</head>
<body>
    <div id="a">
        <table class="tableLayout" id="t1">
            <tr>
                <th>为飞洒地方萨芬</th>
                <th>为为飞洒地方萨芬飞洒地方萨芬2</th>
                <th>是短</th>
                <th>124</th>
                <th style="display:none">为飞洒</th>
                <th style="display:none">为飞洒地方</th>
                <th style="display:none">为为飞洒地方萨芬飞洒地方萨芬2</th>
                <th style="display:none">是短发</th>
                <th style="display:none">短发</th>
                <th style="display:none">为飞洒地方萨</th>
            </tr>
            <tr>
                <td>为飞洒地方萨芬</td>
                <td><div class="ellipsis" style="width:150px;">为为为飞洒地方萨芬飞洒地方萨芬为为飞洒地方萨芬飞洒地方萨芬为飞洒地方萨芬飞洒地方萨芬2</div></td>
                <td>是短发</td>
                <td>124</td>
                <td style="display:none">为飞洒</td>
                <td style="display:none">为飞洒地方</td>
                <td style="display:none">为为飞洒地方萨芬飞洒地方萨芬2</td>
                <td style="display:none">是短发</td>
                <td style="display:none">短发</td>
                <td style="display:none">为飞洒地方萨</td>
            </tr>
        </table>
        <button id="btn" data-status="1">button</button>
        <br/></br>
        <table class="tableLayout" id="t2">
            <tr>
                <th>为飞洒地方萨芬</th>
                <th>为为飞洒地方萨芬飞洒地方萨芬2</th>
                <th>是短</th>
                <th>124</th>
                <th>为飞洒地方萨芬</th>
                <th>为为飞洒地方萨芬飞洒地方萨芬2</th>
                <th>是短</th>
                <th>124</th>
                <th>为飞洒</th>
                <th>为飞洒地方</th>
                <th style="display:none">为为飞洒地方萨芬飞洒地方萨芬2</th>
                <th style="display:none">是短发</th>
                <th style="display:none">短发</th>
                <th style="display:none">为飞洒地方萨</th>
            </tr>
            <tr>
                <td>为飞洒地方萨芬</td>
                <td><div class="ellipsis" style="width:150px;">为为为飞洒地方萨芬飞洒地方萨芬为为飞洒地方萨芬飞洒地方萨芬为飞洒地方萨芬飞洒地方萨芬2</div></td>
                <td>是短发</td>
                <td>124</td>
                <td>为飞洒地方萨芬</td>
                <td>为为飞洒地方萨芬飞洒地方萨芬2</td>
                <td>是短</td>
                <td>124</td>
                <td>为飞洒</td>
                <td>为飞洒地方</td>
                <td style="display:none">为为飞洒地方萨芬飞洒地方萨芬2</td>
                <td style="display:none">是短发</td>
                <td style="display:none">短发</td>
                <td style="display:none">为飞洒地方萨</td>
            </tr>
        </table>
        <button id="btn1" data-status="1">button</button>
    </div>
    <script type="text/javascript">
        $(function(){
            $("#t1").fixTable({w:800});
            $("#t2").fixTable({w:800});
        })
        $('#btn').click(function(){
            if($(this).data('status')){
                $(this).data('status',0);
                $("#t1 tr").each(function(){
                    $(this).find('> :gt(3)').show();
                })
            }else{
                $(this).data('status',1);
                $("#t1 tr").each(function(){
                    $(this).find('> :gt(3)').hide();
                })
            }
            $("#t1").fixTable({w:800});
        })
        $('#btn1').click(function(){
            if($(this).data('status')){
                $(this).data('status',0);
                $("#t2 tr").each(function(){
                    $(this).find('> :gt(9)').show();
                })
            }else{
                $(this).data('status',1);
                $("#t2 tr").each(function(){
                    $(this).find('> :gt(9)').hide();
                })
            }
            $("#t2").fixTable({w:800});
        })
    </script>
</body>
</html>
